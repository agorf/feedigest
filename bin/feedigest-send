#!/usr/bin/env ruby

begin
  require 'dotenv/load'
rescue LoadError
end

if ENV['FEEDIGEST_EMAIL_RECIPIENT'].nil?
  puts 'Please set $FEEDIGEST_EMAIL_RECIPIENT and try again'
  exit 1
end

require 'feedigest'

puts 'Please provide a list of feed URLs (one per line) and press Ctrl-D'

feed_urls = $stdin.readlines.map(&:strip)

Feedigest::FeedFetcher.new(feed_urls).feeds.
  yield_self { |feeds| Feedigest::MailComposer.new(feeds).mail }.
  yield_self { |mail| Feedigest::MailSender.new(mail) }.
  deliver
